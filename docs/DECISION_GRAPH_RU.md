# Граф принятия решений AI Hedge Fund

## Общее описание
Граф принятия решений в AI Hedge Fund представляет собой направленный ациклический граф (DAG), реализованный с помощью библиотеки `langgraph`. Этот граф определяет последовательность и взаимодействие между различными AI-агентами в процессе анализа и принятия инвестиционных решений.

## Структура графа

### 1. Состояние (State)
Состояние графа определяется классом `AgentState`, который содержит:
- `messages`: последовательность сообщений между агентами
- `data`: словарь с данными анализа
- `metadata`: метаданные процесса

### 2. Узлы графа

#### 2.1 Начальный узел
- Название: `start_node`
- Функция: `start()`
- Назначение: инициализация рабочего процесса

#### 2.2 Аналитические узлы
Доступные аналитики:
- Technical Analyst (`technical_analyst_agent`)
- Fundamentals Analyst (`fundamentals_agent`)
- Sentiment Analyst (`sentiment_agent`)
- Valuation Analyst (`valuation_agent`)
- Warren Buffett Agent (`warren_buffett_agent`)
- Bill Ackman Agent (`bill_ackman_agent`)

#### 2.3 Управляющие узлы
- Risk Management Agent (`risk_management_agent`)
- Portfolio Management Agent (`portfolio_management_agent`)

### 3. Структура связей

```
start_node
    │
    ├─► technical_analyst
    ├─► fundamentals_analyst
    ├─► sentiment_analyst
    ├─► valuation_analyst           ┐
    ├─► warren_buffett             ─┼─► risk_management ─► portfolio_management ─► END
    └─► bill_ackman               ─┘
```

## Процесс принятия решений

1. **Инициализация**
   - Граф начинает работу с узла `start_node`
   - Инициализируется начальное состояние `AgentState`

2. **Параллельный анализ**
   - Все аналитические агенты работают параллельно
   - Каждый агент анализирует данные в своей специализации
   - Результаты сохраняются в общем состоянии

3. **Управление рисками**
   - Все результаты аналитиков поступают в `risk_management_agent`
   - Происходит оценка рисков и фильтрация решений

4. **Управление портфелем**
   - `portfolio_management_agent` принимает финальные решения
   - Формируются конкретные торговые сигналы

## Конфигурация графа

### Настройка аналитиков
```python
# Пример выбора конкретных аналитиков
selected_analysts = [
    "technical_analyst",
    "fundamentals_analyst",
    "warren_buffett"
]
workflow = create_workflow(selected_analysts)
```

### Добавление нового агента
Для добавления нового агента необходимо:
1. Создать функцию агента
2. Добавить агента в словарь `analyst_nodes`
3. Определить связи с другими узлами

## Особенности реализации

### 1. Гибкость конфигурации
- Возможность выбора конкретных аналитиков
- Динамическое создание связей
- Масштабируемая архитектура

### 2. Обработка данных
- Использование TypedDict для типизации
- Слияние словарей для агрегации результатов
- Сериализация сложных объектов

### 3. Визуализация
- Функция `show_agent_reasoning()` для отображения логики
- Поддержка различных форматов вывода
- Красивое форматирование JSON

## Преимущества архитектуры

1. **Масштабируемость**
   - Легкое добавление новых агентов
   - Гибкая конфигурация связей

2. **Изоляция**
   - Каждый агент работает независимо
   - Четкое разделение ответственности

3. **Отказоустойчивость**
   - Ошибка одного агента не влияет на других
   - Возможность обработки исключений

4. **Прозрачность**
   - Четкая визуализация процесса
   - Логирование решений каждого агента

## Ограничения

1. **Последовательность выполнения**
   - Строгий порядок прохождения через risk_management и portfolio_management
   - Невозможность прямых связей между аналитическими агентами

2. **Состояние**
   - Общее состояние должно быть сериализуемым
   - Необходимость правильного слияния данных

## Рекомендации по использованию

1. **Выбор аналитиков**
   - Выбирайте комбинации аналитиков под конкретные задачи
   - Учитывайте возможные конфликты в рекомендациях

2. **Мониторинг**
   - Используйте `show_agent_reasoning` для отладки
   - Следите за качеством данных между узлами

3. **Расширение**
   - Следуйте существующей структуре при добавлении агентов
   - Документируйте новые взаимодействия
