# Warren Buffett Agent

## Общее описание
Warren Buffett Agent - это специализированный агент, который анализирует акции, используя инвестиционные принципы Уоррена Баффета. Агент фокусируется на поиске компаний с устойчивым конкурентным преимуществом, стабильными доходами и разумной ценой.

## Основные компоненты анализа

### 1. Фундаментальный анализ (`analyze_fundamentals`)
#### Анализируемые факторы:
- Рентабельность капитала (ROE)
- Рентабельность активов (ROA)
- Долговая нагрузка
- Операционная эффективность
- Прибыльность

#### Метрики:
- Return on Equity (ROE)
- Return on Assets (ROA)
- Debt to Equity
- Operating Margin
- Net Margin

### 2. Анализ стабильности (`analyze_consistency`)
#### Анализируемые факторы:
- Стабильность прибыли
- Темпы роста
- Качество доходов
- Предсказуемость бизнеса

#### Метрики:
- Динамика чистой прибыли
- Стабильность операционных показателей
- Тренды роста
- Волатильность показателей

### 3. Расчет внутренней стоимости (`calculate_intrinsic_value`)
#### Методология:
- Расчет прибыли владельца (Owner Earnings)
- Дисконтирование денежных потоков
- Оценка маржи безопасности

#### Компоненты:
```python
Owner Earnings = Net Income + Depreciation - Maintenance CapEx
```

## Процесс принятия решений

### 1. Сбор данных
```python
metrics = get_financial_metrics(ticker, end_date, period="ttm", limit=5)
financial_line_items = search_line_items(
    ticker,
    [
        "capital_expenditure",
        "depreciation_and_amortization",
        "net_income",
        "outstanding_shares",
        "total_assets",
        "total_liabilities",
    ],
    end_date,
    period="ttm",
    limit=5
)
```

### 2. Анализ данных
1. **Фундаментальный анализ**:
   - Оценка качества бизнеса
   - Анализ финансовой устойчивости
   - Исследование конкурентных преимуществ

2. **Анализ стабильности**:
   - Оценка исторической динамики
   - Анализ предсказуемости доходов
   - Исследование устойчивости бизнес-модели

3. **Оценка стоимости**:
   - Расчет прибыли владельца
   - Определение внутренней стоимости
   - Оценка маржи безопасности

### 3. Формирование сигнала
```python
if total_score >= 0.7 * max_possible_score:
    signal = "bullish"
elif total_score <= 0.3 * max_possible_score:
    signal = "bearish"
else:
    signal = "neutral"
```

## Особенности реализации

### 1. Система скоринга
- Оценка фундаментальных показателей
- Анализ стабильности бизнеса
- Учет маржи безопасности

### 2. Расчет прибыли владельца
```python
def calculate_owner_earnings(financial_line_items):
    """
    Owner Earnings = Net Income + Depreciation - Maintenance CapEx
    """
    latest_data = financial_line_items[0]
    
    net_income = latest_data.get("net_income", 0)
    depreciation = latest_data.get("depreciation_and_amortization", 0)
    capex = latest_data.get("capital_expenditure", 0)
    
    # Оценка maintenance CapEx как 70% от общего CapEx
    maintenance_capex = abs(capex) * 0.7
    
    owner_earnings = net_income + depreciation - maintenance_capex
    return owner_earnings
```

### 3. Оценка маржи безопасности
```python
margin_of_safety = (intrinsic_value - market_cap) / market_cap
if margin_of_safety > 0.3:  # 30% маржа безопасности
    total_score += 2
```

## Выходные данные

### 1. Структура анализа
```python
analysis_data = {
    "signal": str,                    # bullish/bearish/neutral
    "score": float,                   # общий скор
    "max_score": float,               # максимально возможный скор
    "fundamental_analysis": {          # фундаментальный анализ
        "score": float,
        "details": dict
    },
    "consistency_analysis": {          # анализ стабильности
        "score": float,
        "details": dict
    },
    "intrinsic_value_analysis": {      # анализ стоимости
        "intrinsic_value": float,
        "details": dict
    },
    "market_cap": float,               # текущая капитализация
    "margin_of_safety": float          # маржа безопасности
}
```

### 2. Инвестиционный сигнал
```python
buffett_analysis = {
    "signal": str,          # инвестиционный сигнал
    "confidence": float,    # уверенность в решении
    "reasoning": str        # подробное обоснование
}
```

## Принципы инвестирования Уоррена Баффета

### 1. Понятный бизнес
- Простая и понятная бизнес-модель
- Предсказуемые доходы
- Понятные конкурентные преимущества

### 2. Устойчивое конкурентное преимущество
- Сильный бренд
- Сетевые эффекты
- Экономия на масштабе
- Патенты и лицензии

### 3. Качественный менеджмент
- Эффективное использование капитала
- Разумная дивидендная политика
- Прозрачность управления

### 4. Разумная цена
- Значительный дисконт к внутренней стоимости
- Консервативная оценка
- Долгосрочный подход

## Ограничения и особенности

### 1. Ограничения модели
- Фокус на публичных компаниях
- Упрощенный подход к оценке
- Ограниченность исторических данных

### 2. Риски
- Рыночные риски
- Риски оценки
- Качество данных

### 3. Рекомендации по использованию
- Долгосрочный инвестиционный горизонт
- Комбинирование с другими методами анализа
- Регулярный пересмотр оценок

## Планы по улучшению

### 1. Расширение анализа
- Добавление качественных факторов
- Улучшение оценки менеджмента
- Расширение источников данных

### 2. Оптимизация
- Улучшение расчета внутренней стоимости
- Оптимизация использования данных
- Улучшение системы скоринга

### 3. Интеграция
- Улучшение взаимодействия с другими агентами
- Расширение анализа конкурентных преимуществ
- Добавление анализа отраслевых факторов
